(()=>{"use strict";var t={250:(t,e,n)=>{n.d(e,{A:()=>K}),t=n.hmd(t);const r=["","X","Ls","Lms","Lmns","HLmns","HLmnst","BHLmnst","BHLmnstw","BCHLmnstw","BCHLmnpstw","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"];function o(t,e){for(t=Math.abs(t),e=Math.abs(e);0!==e;)[t,e]=[e,t%e];return t}function s(t,e){const[n,r,o]=i(t,e);if(1!==n)throw new Error("Non-coprime generator error");return(r%e+e)%e}function i(t,e){let[n,r]=[t,e],[o,s]=[1,0],[i,l]=[0,1];for(;0!==r;){const t=Math.floor(n/r);[n,r]=[r,n-t*r],[o,s]=[s,o-t*s],[i,l]=[l,i-t*l]}return[n,o,i]}function l(t,e){return(t%e+e)%e}function c(t,e){if(0===t.length)return[...t];const n=l(e,t.length);return 0===n?[...t]:[...t.slice(n),...t.slice(0,n)]}function a(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1}return t.length-e.length}function u(t){return Array.from({length:t.length},(e,n)=>c(t,n))}function d(t){const e=t.length,n=new Array(2*e).fill(-1);let r=0;for(let o=1;o<2*e;o++){let s=n[o-r-1];for(;-1!==s&&t[o%e]!==t[(r+s+1)%e];)t[o%e]<t[(r+s+1)%e]&&(r=o-s-1),s=n[s];-1===s&&t[o%e]!==t[(r+s+1)%e]?(t[o%e]<t[(r+s+1)%e]&&(r=o),n[o-r]=-1):n[o-r]=s+1}return r}function f(t){return c(t,d(t))}class m{constructor(t=new Map){this.map=new Map(t)}static ZERO=new m;static fromSlice(t){const e=new Map;for(const n of t)e.set(n,(e.get(n)||0)+1);return new m(e)}static fromObject(t){return new m(new Map(Object.entries(t).map(([t,e])=>[parseInt(t),e])))}add(t){const e=new Map(this.map);for(const[n,r]of t.map){const t=(e.get(n)||0)+r;0===t?e.delete(n):e.set(n,t)}return new m(e)}neg(){const t=new Map;for(const[e,n]of this.map)t.set(e,-n);return new m(t)}scalarMul(t){const e=new Map;for(const[n,r]of this.map)e.set(n,t*r);return new m(e)}get(t){return this.map.get(t)||0}len(){let t=0;for(const e of this.map.values())t+=Math.abs(e);return t}isEmpty(){return 0===this.len()}keys(){return[...this.map.keys()].sort((t,e)=>t-e)}toObject(){const t={};for(const[e,n]of this.map)t[e]=n;return t}toArray(){const t=Math.max(...this.keys(),0),e=new Array(t+1).fill(0);for(const[t,n]of this.map)e[t]=n;return e}equals(t){if(this.map.size!==t.map.size)return!1;for(const[e,n]of this.map)if(t.get(e)!==n)return!1;return!0}toString(){return JSON.stringify(this.toObject())}}function h(t,e,n){const r=c(t,e);if(n<=t.length)return r.slice(0,n);{const e=Math.floor(n/t.length),o=n%t.length;let s=[];for(let t=0;t<e;t++)s=s.concat(r);return s.concat(r.slice(0,o))}}function p(t,e,n){return m.fromSlice(h(t,e,n))}function g(t,e){const n=new Set,r=[];for(let o=0;o<t.length;o++){const s=p(t,o,e),i=s.toString();n.has(i)||(n.add(i),r.push(s))}return r}function y(t){if(0===t.length)return 0;let e=0;const n=Math.floor(t.length/2);for(let r=1;r<=n;r++){const n=g(t,r);e=Math.max(e,n.length)}return e}function b(t,e){const n=o(t,e);if(1===n){const n=s(t,t+e),r=[];let[o,i]=[0,0];for(;o!==t||i!==e;)t*i>=e*(o+1)?(o+=1,r.push(0)):(i+=1,r.push(1));const l=m.fromSlice(r.slice(0,n));return[r,l]}{const[r,o]=b(t/n,e/n),s=[];for(let t=0;t<n;t++)s.push(...r);return[s,o]}}function w(t){return new Set(t).size}function x(t,e,n){return t.map(t=>t===e?n:t)}function v(t,e){return t.filter(t=>t!==e)}function L(t){return 2===y(x(t,1,0))}function E(t){return 2===y(x(t,2,1))}function M(t){return 2===y(v(t,2))}function T(t,e,n){if(0===n.length)return t.filter(t=>t!==e);const r=[];let o=0;for(const s of t)s===e?(r.push(n[o%n.length]),o++):r.push(s);return r}function k(t,e,n){const[r,o]=b(t,e+n),[s,i]=b(e,n),l=s.map(t=>t+1),a=i.len(),u=[];for(let t=0;t<e+n;t++){const e=c(l,t*a%l.length);u.push(T(r,1,e))}return u}function $(t){const[e,n,r]=t,o=[...k(e,n,r),...k(n,r,e).map(t=>t.map(t=>(t+1)%3)),...k(r,e,n).map(t=>t.map(t=>0===t?2:(t-1)%3))],s=new Set,i=[];for(const t of o){const e=f(t),n=e.join(",");s.has(n)||(s.add(n),i.push(e))}return i.sort((t,e)=>a(t,e))}function S(t,e,n,r){return 3===w(t)&&2===y(v(t,e))&&2===y(x(t,n,r))}function C(t){const e=a(f(t),f([...t].reverse()));return e<0?"Right":e>0?"Left":"Achiral"}function N(t,e){return Array.from({length:e.length},(n,r)=>{const o=h(e,t*r,t);return m.fromSlice(o)})}function _(t){const e=t.length,n=[];for(const r of u(t)){const t=r[e-1],o=r.slice(0,e-1);let s=!1;for(const e of o)if(e.equals(t)){s=!0;break}s||n.push(O(o))}return n}function O(t){for(let e=1;e<=t.length;e++){const n=t.slice(0,e);let r=!0;for(let o=0;o<t.length;o++)if(!t[o].equals(n[o%e])){r=!1;break}if(r)return n}return t}function B(t,e){return _(N(t,e))}function H(t,e){if(t.length!==e.length)return null;for(let n=0;n<t.length;n++){const r=c(e,n);let o=!0;for(let e=0;e<t.length;e++)if(!t[e].equals(r[e])){o=!1;break}if(o)return n}return null}class A{constructor(t,e=[m.ZERO]){this.gs=t,this.polyoffset=e}complexity(){return this.gs.length*this.polyoffset.length}multiplicity(){return this.polyoffset.length}static trySimple(t,e){return 0===t.length||1!==o(t.length,e)?[]:B(e,t).map(t=>new A(t,[m.ZERO]))}static tryMultiple(t,e,n){if(1===e||0===t.length||t.length%e!==0)return[];const r=o(n,t.length);if(t.length/r%e!==0&&r===e){const e=[];for(let n=0;n<r;n++){const o=N(r,c(t,n));e.push(o.slice(0,t.length/r))}const n=e[0],o=[];for(let s=0;s<e.length;s++){const i=H(n,e[s]);if(null===i)return[];o.push(m.fromSlice(h(t,0,i*r+s)))}return o.sort((t,e)=>t.len()-e.len()),1===o.length&&o[0].equals(m.ZERO)?I(n).map(t=>new A(t,[m.ZERO])):I(n).map(t=>new A(t,o))}return[]}}function I(t){if(2===t.length)return[[t[0]]];const e=t.length,n=[];for(let r=2;r<=e/2;r++)if(1===o(r,e)){const o=[];for(let n=0;n<e;n++){let s=m.ZERO;for(let o=0;o<r;o++)s=s.add(t[(n*r+o)%e]);o.push(s)}n.push(..._(o))}return n}function j(t){const e=[],n=t.length;for(let r=2;r<=n-2;r++)1===o(r,n)&&e.push(...A.trySimple(t,r));const r=[];for(let t=2;t<=Math.sqrt(n);t++)n%t===0&&(r.push(t),t!==n/t&&r.push(n/t));for(const o of r)for(let r=2;r<=n-2;r++)e.push(...A.tryMultiple(t,o,r));e.sort((t,e)=>t.complexity()-e.complexity());const s=new Set,i=[];for(const t of e){const e=JSON.stringify({gs:t.gs.map(t=>t.toString()),polyoffset:t.polyoffset.map(t=>t.toString())});s.has(e)||(s.add(e),i.push(t))}return i}function R(t){const{gs:e,polyoffset:n}=t,r=t=>({0:t.get(0)||0,1:t.get(1)||0,2:t.get(2)||0});return{gs:e.map(r),aggregate:r(e.reduce((t,e)=>t.add(e),m.ZERO)),polyoffset:n.map(r),multiplicity:t.multiplicity(),complexity:t.complexity()}}function q(t,e,n){const r=(t,e)=>Array.isArray(t)?t[e]:t[String(e)]??t[e]??0;return r(t,0)*r(e,1)*r(n,2)+r(t,1)*r(e,2)*r(n,0)+r(t,2)*r(e,0)*r(n,1)-r(t,2)*r(e,1)*r(n,0)-r(t,1)*r(e,0)*r(n,2)-r(t,0)*r(e,2)*r(n,1)}function z(t){return Array.isArray(t),{0:t[0]||0,1:t[1]||0,2:t[2]||0}}function G(t,e){for(const n of t)if(1===n.multiplicity()){const t=R(n),r=t.gs;for(let n=0;n<r.length;n++)for(let o=n;o<r.length;o++)if(1===Math.abs(q(e,r[n],r[o])))return[z(r[n]),z(r[o]),t];const o=t.polyoffset;for(const n of o)for(const o of r)if(1===Math.abs(q(e,n,o)))return[z(n),z(o),t]}else{const t=R(n),r=t.gs[0],o=t.polyoffset;if(o.length>0){const n=o[o.length-1];if(1===Math.abs(q(e,r,n)))return[z(r),z(n),t]}}return null}function P(t){if(0===t.length)return[];const e=[],n=[];for(let r=0;r<t.length;r++)t[r]>0&&(n.push(r),e.push(t[r]));if(0===e.length)return[];const r=e.length,o=e.reduce((t,e)=>t+e,0),s=[...e];s[0]-=1;const i=[0];for(let t=1;t<o;t++)i.push(r-1);const l=[];for(let t=r-1;t>=0;t--)0===t&&0===s[0]||l.push(t);const c=[];return Z(s,new Array(o).fill(0),l,i,1,1,1,c,r,o),c.map(t=>t.map(t=>n[t]))}function Z(t,e,n,r,o,s,i,l,c,a){if(t[c-1]===a-o)(t[c-1]===e[o-s]&&a%s===0||t[c-1]>e[o-s])&&l.push([...r]);else if(t[0]!==a-o){if(n.length>0){let u=0,d=n[u];for(;d>=r[o-s];){e[i]=o-i;const f=1===t[d];if(f){const t=n.indexOf(d);-1!==t&&n.splice(t,1)}if(t[d]-=1,r[o]=d,Z(t,e,n,r,o+1,d===r[o-s]?s:o+1,d===c-1?i:o+1,l,c,a),f){let t=0;for(;t<n.length&&n[t]>d;)t++;n.splice(t,0,d)}for(t[d]+=1,u++;u<n.length&&n[u]>=d;)u++;if(u>=n.length)break;d=n[u]}}r[o]=c-1}}function D(t){const e=[],n=new Set(t).size,o=r[Math.min(n,11)];for(const n of t){const t=o.indexOf(n);-1!==t&&e.push(t)}return e}function J(t){const e=new Set(t).size,n=r[Math.min(e,11)];let o="";for(const e of t)e<n.length&&(o+=n[e]);return o}function U(t){const e=[0,0,0];for(const n of t)n<3&&e[n]++;return e}function F(t,e,n=1200){return t/e*n}function V(t,e=111,n=20,r=200,o=1200){const s=[];for(let i=3;i<e;i++)for(let l=2;l<i;l++)for(let c=1;c<l;c++){const a=i*t[0]+l*t[1]+c*t[2];if(a<=e){const t=F(c,a,o);n<=t&&t<=r&&s.push([i,l,c])}}return s}function X(t){const e=J(f(t)),n=L(t),r=E(t),o=M(t),s=C(t),i=J(f([...t].reverse())),l=y(t),c=U(t),a=S(t,0,1,2),u=S(t,1,0,2),d=S(t,2,0,1),m=G(j(t),c);if(m){const[t,c,f]=m;return{word:e,lattice_basis:[t,c],chirality:s,reversed:i,structure:f,lm:n,ms:r,s0:o,subst_l_ms:a,subst_m_ls:u,subst_s_lm:d,mv:l}}return{word:e,lattice_basis:null,chirality:s,reversed:i,structure:null,lm:n,ms:r,s0:o,subst_l_ms:a,subst_m_ls:u,subst_s_lm:d,mv:l}}function W(t){return V(t).map(e=>{const n=e[0]*t[0]+e[1]*t[1]+e[2]*t[2];return e.map(t=>`${t}\\${n}`)})}const Y={EDO_BOUND:111,S_LOWER_BOUND:20,S_UPPER_BOUND:200,STEP_LETTERS:r,gcd:o,modinv:s,extendedGcd:i,mod:l,rotate:c,arraysEqual:function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0},compareArrays:a,rotations:u,booth:d,leastMode:f,CountVector:m,wordOnDegree:h,dyadOnDegree:p,distinctSpectrum:g,maximumVariety:y,darkestMosModeAndGenBresenham:b,stepVariety:w,replace:x,deleteStep:v,monotoneLm:L,monotoneMs:E,monotoneS0:M,subst:T,mosSubstitutionScales:$,isMosSubst:S,chirality:C,stackedKSteps:N,guidedGsChains:_,kStepGuidedGsList:B,guidedGsList:function(t){const e=t.length,n=[];for(let r=2;r<=e-2;r++)1===o(r,e)&&n.push(...B(r,t));return n},GuideFrame:A,guideFrames:j,guideFrameToResult:R,det3:q,toStepVectorObj:z,getUnimodularBasis:G,necklacesFixedContent:P,stringToNumbers:D,numbersToString:J,wordToSig:U,stepsAsCents:F,edTuningsForTernary:V,wordToProfile:X,sigToEdTunings:W,sigResult:function(t,{lm:e=!1,ms:n=!1,s0:r=!1,ggsLen:o=0,ggsLenConstraint:s="at most",complexity:i=0,complexityConstraint:l="at most",mv:c=0,mvConstraint:a="at most",mosSubst:u="off"}={}){const d=t;let f;f="on"===u?$(d):P(d),f=f.filter(t=>{if(e&&!L(t))return!1;if(n&&!E(t))return!1;if(r&&!M(t))return!1;if(o>0){const e=j(t);if(0===e.length)return!1;if("exactly"===s){if(e[0].gs.length!==o)return!1}else if(e[0].gs.length>o)return!1}if(c>0){const e=y(t);if("exactly"===a){if(e!==c)return!1}else if(e>c)return!1}if(i>0){const e=j(t);if(0===e.length)return!1;if("exactly"===l){if(e[0].complexity()!==i)return!1}else if(e[0].complexity()>i)return!1}return!0});const m=f.map(t=>X(t));return m.sort((t,e)=>(t.structure?t.structure.complexity:255)-(e.structure?e.structure.complexity:255)),{profiles:m,ji_tunings:[],ed_tunings:W(d)}},wordResult:function(t){const e=D(t),n=U(e);return{profile:X(e),ji_tunings:[],ed_tunings:W(n)}}};t.exports&&(t.exports=Y),"undefined"!=typeof window&&(window.TernaryLib=Y);const K=Y}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var s=e[r]={id:r,loaded:!1,exports:{}};return t[r](s,s.exports,n),s.loaded=!0,s.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var r=n(250);const o=300,s=35,i=-35;let l=null,c=null,a=null,u=null;const d=document.getElementById("status");function f(t,e){let n=0;for(let r=0;r<t.length;r++)t[r]===e&&n++;return n}function m(t){const e=[...Object.keys(t)],n=["L","m","s"];if(0===e.length)return"0";let r="";for(let o=0;o<e.length;++o)r+=`${t[e[o]]}${n[o]}`,o<e.length-1&&(r+="+");return r}const{gcd:h,mod:p}=r.A;function g(t,e,n,r,o){if(r<0||r>=e)throw new Error(`switchRows(): matrix index out of bounds! i1: ${r} but m: ${e}`);if(o<0||o>=e)throw new Error(`switchRows(): matrix index out of bounds! i2: ${o} but m: ${e}`);for(let e=0;e<n;e++){const s=t[n*o+e],i=t[n*r+e];[t[n*r+e],t[n*o+e]]=[s,i]}}function y(t,e,n,r,o){for(let e=0;e<n;e++)t[n*r+e]*=o}function b(t,e,n,r,o,s){for(let e=0;e<n;e++)t[n*o+e]+=s*t[n*r+e]}function w(t,e,n=""){const r=document.createElement("tr");let o=function(t,e=""){const n=function(t,e=""){const n=document.createElement("table"),r=n.createTHead();n.setAttribute("class","scrollable clickable");let o=r.insertRow(),s=document.createElement("th");if(s.appendChild(document.createTextNode("#")),o.appendChild(s),t)if(t[0]instanceof Array)for(let e=0;e<t[0].length;++e){let t=document.createElement("th");t.appendChild(document.createTextNode(`${e}`)),o.appendChild(t)}else if("object"==typeof t[0])for(let e of Object.keys(t[0])){let t=document.createElement("th");t.appendChild(document.createTextNode(`${e}`)),o.appendChild(t)}else{let t=document.createElement("th");t.appendChild(document.createTextNode(`${e}`)),o.appendChild(t)}return n}(t,e),r=n.createTBody();if(t[0]instanceof Array)for(const[e,n]of t.entries()){let n=r.insertRow();n.insertCell().appendChild(document.createTextNode(`${e+1}`));for(const r of t[e].values()){let t=document.createElement("td");t.appendChild(document.createTextNode(r)),n.appendChild(t)}}else if("object"==typeof t[0])for(const[e,n]of t.entries()){let t=r.insertRow();t.insertCell().appendChild(document.createTextNode(`${e+1}`));for(const e of Object.values(n)){let n=document.createElement("td");n.appendChild(document.createTextNode(`${e}`)),t.appendChild(n)}}else for(const[e,n]of t.entries()){let n=r.insertRow();n.insertCell().appendChild(document.createTextNode(`${e+1}`));let o=document.createElement("td");o.appendChild(document.createTextNode(t[e])),n.appendChild(o)}return n}(e,n);r.appendChild(o),t.appendChild(r)}!function(){function t(){if(d){let t,e,n,r;d.innerText="";const a=document.getElementById("lattice-vis");if(a){a.innerHTML="",a.setAttribute("style","vertical-align: text-top;");const u=document.createElementNS("http://www.w3.org/2000/svg","svg");if(u.setAttribute("id","lattice"),document.createElement("style").innerHTML="\n      .small {\n        font: 20px sans-serif;\n        fill: black;\n      }",!l)throw new Error("`currentWord` is null or undefined");if(!c)throw new Error("No suitable lattice basis");{let f=c[0],m=c[1];const h=(t,e)=>Array.isArray(t)?t[e]:t[String(e)]??t[e]??0;let w=[0,0,0],v=l.length;for(let z=0;z<v;++z)switch(l[z]){case"L":++w[0];break;case"m":++w[1];break;case"s":++w[2]}[t,e,n,r]=[1,0,0,1];let[L,E,M,T,k,$]=function(t,e){let n=structuredClone(t),r=structuredClone(e);for(let t=0;t<Math.min(3,3);++t){let e=t+1;for(;e<3&&Math.abs(n[3*t+t])<Number.EPSILON;)g(n,3,3,t,e),g(r,3,2,t,e),e++;if(Math.abs(n[3*t+t])<Number.EPSILON)return null;const o=n[3*t+t];for(let e=t+1;e<3;++e){const s=n[3*e+t];Math.abs(s)>=Number.EPSILON&&(b(n,0,3,t,e,-s/o),b(r,0,2,t,e,-s/o))}}for(let t=Math.min(3,3)-1;t>=0;--t){const e=n[3*t+t];for(let o=0;o<t;++o){const s=n[3*o+t];Math.abs(s)>=Number.EPSILON&&(b(n,0,3,t,o,-s/e),b(r,0,2,t,o,-s/e))}y(n,0,3,t,1/e),y(r,0,2,t,1/e)}return r}([h(f,0),h(f,1),h(f,2),h(m,0),h(m,1),h(m,2),w[0],w[1],w[2]],[t,e,n,r,0,0]);for(let G=-20;G<=20;++G){const P=o+t*s*G,Z=o+e*i*G,D=P+n*s*100,J=Z+r*i*100,U=P+n*s*-100,F=Z+r*i*-100,V=o+n*s*G,X=300+r*i*G,W=V+t*s*100,Y=X+e*i*100,K=V+t*s*-100,Q=X+e*i*-100;u.innerHTML+=`<line\n                x1="${D}"\n                y1="${J}"\n                x2="${U}"\n                y2="${F}"\n                style="stroke:#6c00da; stroke-width:2"\n              />`,u.innerHTML+=`<line\n                x1="${W}"\n                y1="${Y}"\n                x2="${K}"\n                y2="${Q}"\n                style="stroke:gray; stroke-width:2"\n              />`}let S=o,C=300;for(let tt=0;tt<v;++tt)switch(u.innerHTML+=`<circle\n            cx="${S}"\n            cy="${C}"\n            r="7"\n            color="white"\n            fill="white"\n            stroke="white"\n            stroke-width="1"\n          />\n          <text\n            x="${S-3}"\n            y="${C+3}"\n            fill="black"\n            font-size="0.5em"\n          >${p(tt,v)}</text>`,l[tt]){case"L":S+=L*s,C+=E*i;break;case"m":S+=M*s,C+=T*i;break;case"s":S+=k*s,C+=$*i;break;default:throw new Error("Invalid letter")}u.setAttribute("viewBox","0 0 600 600"),a.innerHTML+=`<hr/><h2>Lattice view</h2><br/><small>Ternary scales are special in that they admit a JI-agnostic 2D lattice representation.<br/>Here the two dimensions g = ${x(f)} and h = ${x(m)} are two different generators. g is horizontal, h is vertical.</small>`,a.innerHTML+='<div class="controls">\n        <button id="zoom-in">Zoom In (+)</button>\n        <button id="zoom-out">Zoom Out (-)</button>\n        <button id="reset-view">Reset View</button>\n        <span style="margin-left: 20px;">Zoom: <span id="zoom-level">100%</span></span>\n    </div>',a.appendChild(u);const N=document.getElementById("zoom-in"),_=document.getElementById("zoom-out"),O=document.getElementById("reset-view"),B=document.getElementById("zoom-level");let H={x:0,y:0,width:800,height:600},A=!1,I={x:0,y:0},j=1;function R(){u.setAttribute("viewBox",`${H.x} ${H.y} ${H.width} ${H.height}`),B.textContent=Math.round(100*j)+"%"}function q(t){const e=u.getScreenCTM();return{x:(t.clientX-e.e)/e.a,y:(t.clientY-e.f)/e.d}}u.addEventListener("mousedown",t=>{A=!0,I=q(t)}),u.addEventListener("mousemove",t=>{if(!A)return;t.preventDefault();const e=q(t),n=e.x-I.x,r=e.y-I.y;H.x-=n,H.y-=r,R()}),u.addEventListener("mouseup",()=>{A=!1}),u.addEventListener("mouseleave",()=>{A=!1}),u.addEventListener("wheel",t=>{t.preventDefault();const e=q(t),n=t.deltaY<0?.9:1.1,r=H.width*n,o=H.height*n;H.x+=(e.x-H.x)*(1-n),H.y+=(e.y-H.y)*(1-n),H.width=r,H.height=o,j=800/H.width,R()}),N.addEventListener("click",()=>{const t=H.x+H.width/2,e=H.y+H.height/2;H.width*=.8,H.height*=.8,H.x=t-H.width/2,H.y=e-H.height/2,j=800/H.width,R()}),_.addEventListener("click",()=>{const t=H.x+H.width/2,e=H.y+H.height/2;H.width*=1.25,H.height*=1.25,H.x=t-H.width/2,H.y=e-H.height/2,j=800/H.width,R()}),O.addEventListener("click",()=>{H={x:0,y:0,width:800,height:600},j=1,R()}),R()}}}}function e(){if(l){const t=new Set(Array.from(l)).size;if(a){const e=document.getElementById("sw-code");if(e){e.innerHTML='<hr/><h2>SonicWeave code</h2>\n        (for <a href="https://sw3.lumipakkanen.com/" target="_blank">Scale Workshop 3</a>)<br/>',e.innerHTML+='<pre class="language-ocaml"><code class="language-ocaml" id="codeblock"></code></pre>';const n="Copy";async function r(t,e){let r=t.querySelector("code").innerText;await navigator.clipboard.writeText(r),e.innerText="Copied!",setTimeout(()=>{e.innerText=n},700)}document.querySelectorAll("pre").forEach(t=>{if(navigator.clipboard){let e=document.createElement("button");e.innerText=n,t.appendChild(e),e.addEventListener("click",async()=>{await r(t,e)})}});let o=document.getElementById("codeblock");const s=Array.from(l);o&&(o.innerHTML=3===t?`let L = ${a[0]}\nlet m = ${a[1]}\nlet s = ${a[2]}\n${s.join(";")};\nstack()`:2===t?`let L = ${a[0]}\nlet s = ${a[1]}\n${s.join(";")};\nstack()`:1===t?`let X = ${a[0]}\n${s.join(";")};\nstack()`:"Scales of rank > 3 are not supported")}}}}function n(){const t=document.getElementById("scale-profile");if(t){t.innerHTML="";const e=document.createElement("h2");if(e.innerText=`Scale profile for ${l}`,t.appendChild(e),u){const e=u.structure;if(e){t.innerHTML+='<b><a href="https://en.xen.wiki/w/Guide_frame\n           " target="_blank">Guide frame</a></b><br/><small>';let n=`${e.gs.map(t=>` ${x(t)}`)}`.slice(1);t.innerHTML+=`Guided <a href="https://en.xen.wiki/w/Generator_sequence" target="_blank">generator sequence</a> of ${function(t){let e=0;for(let n of Object.keys(t))e+=t[n];return e}(e.gs[0])}-steps: GS(${n})<br/>`,t.innerHTML+=`Aggregate generator ${x(e.aggregate)}<br/>`,t.innerHTML+=`Offsets ${e.polyoffset.map(t=>x(t))}<br/>`,t.innerHTML+=`Multiplicity ${JSON.stringify(e.multiplicity)}<br/>`,t.innerHTML+=`Complexity ${JSON.stringify(e.complexity)}<br/><br/>`,t.innerHTML+='<b><a href="https://en.xen.wiki/w/Monotone-MOS_scale" target="_blank">Monotone MOS properties</a></b><br/>',t.innerHTML+=u.lm?"L = m<br/>":"",t.innerHTML+=u.ms?"m = s<br/>":"",t.innerHTML+=u.s0?"s = 0<br/>":"",u.lm||u.ms||u.s0||(t.innerHTML+="None<br/>"),t.innerHTML+="<br/>";const r=f(l,"L"),o=f(l,"m"),s=f(l,"s");t.innerHTML+='<b><a href="https://en.xen.wiki/w/MOS_substitution" target="_blank">MOS substitution</a> properties</b><br/>',t.innerHTML+=u.subst_l_ms?`subst ${r}L(${o}m${s}s)<br/>`:"",t.innerHTML+=u.subst_m_ls?`subst ${o}m(${r}L${s}s)<br/>`:"",t.innerHTML+=u.subst_s_lm?`subst ${s}s(${r}L${o}m)<br/>`:"","Achiral"===u.chirality?t.innerHTML+='<br/><a href="https://en.xen.wiki/w/Chirality" target="_blank">Chirality</a>: Achiral':t.innerHTML+=`<br/><a href="https://en.xen.wiki/w/Chirality" target="_blank">Chirality</a>: ${u.chirality} (reversed: ${u.reversed})`,t.innerHTML+=`<br/><a href="https://en.xen.wiki/w/Maximum_variety" target="_blanMaximum variety</a> ${u.mv}</small>`}}}}function x(t){if(a[0].includes("/")){const[e,n]=a[0].split("/"),[r,o]=a[1].split("/"),[s,i]=a[2].split("/"),l=Number(e),c=Number(r),u=Number(s),d=Number(n),f=Number(o),p=Number(i),g=Math.pow(l,t[0]??0)*Math.pow(c,t[1]??0)*Math.pow(u,t[2]??0),y=Math.pow(d,t[0]??0)*Math.pow(f,t[1]??0)*Math.pow(p,t[2]??0),b=h(g,y);return`${m(t)} (${g/b}/${y/b})`}if(a[0].includes("\\")){const[e,n]=a[0].split("\\"),r=Number(n),[o,s]=a[1].split("\\"),[i,l]=a[2].split("\\"),c=Number(e),u=Number(o),d=Number(i);return`${m(t)} (${c*(t[0]??0)+u*(t[1]??0)+d*(t[2]??0)}\\${r})`}return m(t)}function v(t,e,n){t.querySelector(".selected")?.classList.remove("selected"),e.querySelector(".selected")?.classList.remove("selected"),n.classList.add("selected")}const L="Scales of rank 0 or rank 4 or higher are not supported.",E=document.getElementById("btn-sig"),M=document.getElementById("btn-word");E.addEventListener("click",()=>{const o=`${document.getElementById("input-step-sig").value}`.split(" ").map(t=>Number(t)).filter(t=>t),s=o.filter(t=>t>0).length,i=o.reduce((t,e)=>t+e,0);try{if(0===i)d.textContent="Scale is empty. This is a bug.";else if(s>3)d.textContent="Scales of rank 0 or rank 4 or higher are not supported.";else if(s>0){d.textContent="Computing...",document.getElementById("tables").innerHTML='\n      <hr /><h2>Tables</h2>\n\n      <table>\n        <tr>\n                      <td>\n                        Scales\n                        <div\n                          style="\n                            overflow-y: auto;\n                            overflow-x: auto;\n                            vertical-align: top;\n                            height: 420px;\n                            width: 250px;\n                          "\n                        >\n                          <table class="data" id="table-scales"></table>\n                        </div>\n                      </td>\n                      <td>\n                        JI tunings\n                        <div\n                          style="\n                            overflow-y: auto;\n                            overflow-x: auto;\n                            vertical-align: top;\n                            height: 420px;\n                            width: 250px;\n                          "\n                        >\n                          <table class="data" id="table-ji-tunings"></table>\n                        </div>\n                      </td>\n                      <td>\n                        edo tunings\n                        <div\n                          style="\n                            overflow-y: auto;\n                            overflow-x: auto;\n                            vertical-align: top;\n                            height: 420px;\n                            width: 200px;\n                          "\n                        >\n                          <table class="data" id="table-ed-tunings"></table>\n                        </div>\n                      </td></tr></table>';const i=document.getElementById("table-scales"),m=document.getElementById("table-ji-tunings"),h=document.getElementById("table-ed-tunings"),p=r.A.sigResult(o,{lm:document.getElementById("monotone-lm").checked,ms:document.getElementById("monotone-ms").checked,s0:document.getElementById("monotone-s0").checked,ggsLen:Number(document.getElementById("ggs-len").value),ggsLenConstraint:document.querySelector('input[name="ggs-len-constraint"]:checked').value,complexity:Number(document.getElementById("complexity").value),complexityConstraint:document.querySelector('input[name="complexity-constraint"]:checked').value,mv:Number(document.getElementById("mv").value),mvConstraint:document.querySelector('input[name="mv-constraint"]:checked').value,mosSubst:document.querySelector('input[name="mos-subst"]:checked').value}),g=p.profiles.map(t=>t.word),y=p.profiles.map(t=>t.lattice_basis),b=p.profiles,x=p.ji_tunings,E=p.ed_tunings;let M;M=3===s?["L","m","s"]:2===s?["L","s"]:1===s?["X"]:[...Array(s).keys()].map(t=>`X${t}`),d.innerHTML=`<h1>Results for ${f=[...Array(s).keys()].map(t=>`${o[t]}${M[t]}`).join(""),f.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("'","&#39;").replaceAll('"',"&quot;")}</h1> (click on a table row to select a scale or a tuning)`,w(i,g,"scale");const T=i.getElementsByTagName("tr");if(T.length>=3){T[2].classList.add("selected"),l=g[0],u=b[0],c=u.lattice_basis;for(let r=2;r<T.length;++r)T[r].addEventListener("click",async()=>{i.querySelector(".selected").classList.remove("selected"),T[r].classList.add("selected");let o=g[r-2];u=b[r-2],c=y[r-2],l=o,e(),n();try{t()}catch(t){d.innerText=t}})}w(m,x);const k=m.getElementsByTagName("tr");for(let r=2;r<k.length;++r){const o=k[r];o.addEventListener("click",()=>{s>=1&&s<=3?(v(m,h,o),a=x[r-2],e(),n(),t()):d.textContent=L})}if(E){w(h,E);const r=h.getElementsByTagName("tr");r[2].classList.add("selected");const o=E[0];a=o,n(),t(u.structure),e();for(let o=2;o<r.length;++o){const s=r[o];s.addEventListener("click",()=>{v(m,h,s);const r=E[o-2];a=r,n(),t(),e()})}}e(),n(),t()}}catch(t){d.innerText=t}var f}),M.addEventListener("click",()=>{const o=document.getElementById("input-word").value,s=new Set(Array.from(o)).size;d.textContent="Computing...";const i=r.A.wordResult(o),f=i.profile,m=i.profile.word,h=i.ji_tunings,p=i.ed_tunings;document.getElementById("tables").innerHTML='\n                <td>\n                  JI tunings\n                  <div\n                    style="\n                      overflow-y: auto;\n                      overflow-x: auto;\n                      vertical-align: top;\n                      height: 420px;\n                      width: 250px;\n                    "\n                  >\n                    <table class="data" id="table-ji-tunings"></table>\n                  </div>\n                </td>\n                <td>\n                  edo tunings\n                  <div\n                    style="\n                      overflow-y: auto;\n                      overflow-x: auto;\n                      vertical-align: top;\n                      height: 420px;\n                      width: 200px;\n                    "\n                  >\n                    <table class="data" id="table-ed-tunings"></table>\n                  </div>\n                </td>';const g=document.getElementById("table-ji-tunings"),y=document.getElementById("table-ed-tunings");l=m;try{d.innerHTML=`<h1>Results for ${l}</h1>(click on a table row to select a tuning)`,w(g,h);const r=g.getElementsByTagName("tr");for(let o=2;o<r.length;++o){const i=r[o];i.addEventListener("click",()=>{s>=1&&s<=3?(v(g,y,i),a=h[o-2],n(),t(),e()):d.textContent=L})}if(p){w(y,p);const r=y.getElementsByTagName("tr");r[2].classList.add("selected");for(let o=2;o<r.length;++o){const s=r[o];s.addEventListener("click",()=>{v(g,y,s);const r=p[o-2];a=r,n(),t(),e()})}}a=p[0],e(),u=f,c=u.lattice_basis,n(),t(),e()}catch(t){d.innerText=t}})}()})();